<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Formulir SKCK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body { font-family: Segoe UI, Arial, sans-serif; background: #f8fafc; color: #222; }
    .container { max-width: 1100px; margin: 40px auto; background: #fff; border-radius: 14px; padding: 28px; box-shadow: 0 6px 32px #0001;}
    h2 { text-align: center; color: #2563eb; margin-bottom: 28px;}
    table { border-collapse: collapse; width: 100%; margin: 0; }
    th, td { border: 1px solid #e5e7eb; padding: 8px 12px; }
    th { background: #2563eb; color: #fff; font-weight: 600; }
    tr:nth-child(even) { background: #f1f5f9;}
    td a { color: #2563eb; text-decoration: underline;}
    .file-link {font-size: 1.2em;}
    .loader { text-align: center; margin-top: 48px; }
    .btn-refresh { background: #2563eb; color: #fff; border: none; border-radius: 6px; padding: 8px 18px; cursor: pointer; margin-bottom: 18px; }
    .btn-refresh:hover { background: #1943a8; }
    .no-data { text-align: center; padding: 44px 0; color: #888;}
    @media (max-width: 700px) {
      th, td { font-size: 0.95em; padding: 7px 4px;}
      .container { padding: 8px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Data Pendaftaran SKCK</h2>
    <button class="btn-refresh" onclick="loadData()"><i class="fas fa-sync-alt"></i> Muat Ulang</button>
    <div id="table-area">
      <div class="loader">Memuat data...</div>
    </div>
  </div>
  <script>
    // Ganti dengan data Supabase projekmu
    const supabaseUrl = "https://esfeooendxloxnhkuknt.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzZmVvb2VuZHhsb3huaGt1a250Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5NTgyMzcsImV4cCI6MjA2NTUzNDIzN30.YiJlNEiLfV4ReVaZ_VLbiI-CXgMoIeDpGyq4ywMzZ7U";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function loadData() {
      const area = document.getElementById('table-area');
      area.innerHTML = '<div class="loader">Memuat data...</div>';
      // Ambil data dari tabel skck_form, urut terbaru
      let { data, error } = await supabase
        .from('skck')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        area.innerHTML = '<div style="color:red">Gagal memuat data: ' + error.message + '</div>';
        return;
      }

      if (!data || data.length === 0) {
        area.innerHTML = '<div class="no-data">Belum ada data pendaftaran.</div>';
        return;
      }

      let html = `<div style="overflow-x:auto;"><table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Petugas</th>
            <th>UCP</th>
            <th>Nama Lengkap</th>
            <th>Usia</th>
            <th>JK</th>
            <th>Keperluan</th>
            <th>No HP</th>
            <th>Foto KTP?</th>
            <th>Total Harga</th>
            <th>Discord ID</th>
            <th>Waktu Daftar</th>
            <th>File KTP</th>
          </tr>
        </thead>
        <tbody>
      `;
      data.forEach((row, i) => {
        html += `<tr>
          <td>${i+1}</td>
          <td>${row.petugas || ''}</td>
          <td>${row.ucp || ''}</td>
          <td>${row.nama || ''}</td>
          <td>${row.usia || ''}</td>
          <td>${row.jk || ''}</td>
          <td>${row.keperluan || ''}</td>
          <td>${row.nomorhp || ''}</td>
          <td>${row.foto_ktp || ''}</td>
          <td>${row.harga || ''}</td>
          <td>${row.discordid || ''}</td>
          <td>${row.created_at ? new Date(row.created_at).toLocaleString() : ''}</td>
          <td>${
            row.file_ktp_url
              ? `<a href="${row.file_ktp_url}" target="_blank" class="file-link"><i class="fas fa-file"></i> Lihat</a>`
              : '-'
          }</td>
        </tr>`;
      });
      html += `</tbody></table></div>`;
      area.innerHTML = html;
    }
    // Auto load saat laman dibuka
    loadData();
  </script>
</body>
</html>